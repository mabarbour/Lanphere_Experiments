agg329$sp329.attack[is.na(agg329$sp329.attack)] <- 0 # change all of the NA's in the column to zero
glm.329 <- glm(sp329.attack~Genotype*as.factor(Treatment)+Block,family="poisson",agg329)
summary(glm.329)
anova(glm.329,test="Chisq") # I suspect that my abundances are too low.
with(agg329, interaction.plot(Treatment,Genotype,sp329.attack)) # no clear effect...
with(agg329, table(Treatment,Genotype,sp329.attack))
LTF.329 <- merge(aggLTF,agg329)
head(LTF.329)
aggLTF.329 <- aggregate(sp329.attack + LTF.survive ~ Genotype + Wind.Exposure, FUN=mean, LTF.329)
head(aggLTF.329)
aggLTFcorr <- aggregate(LTF.survive ~ Genotype + Wind.Exposure, FUN=mean, LTF.329)
agg329corr <- aggregate(sp329.attack~Genotype+Wind.Exposure,FUN=mean,LTF.329)
LTF.329corr <- merge(aggLTFcorr,agg329corr)
LTF.329corr
plot(sp329.attack~Genotype,LTF.329corr)
plot(sp329.attack~LTF.survive,LTF.329corr)
cor.test(sp329.attack,LTF.survive)
with(LTF.329corr, cor.test(sp329.attack,LTF.survive))
with(LTF.329corr, cor.test(sp329.attack,LTF.survive, method="spearman")) # okay, highly significant correlation between parasitoid abundance and abundances of LTFs when they are averaged across genotypes and wind exposure (i.e. 20 points)
with(LTF.329corr, cor.test(sp329.attack,LTF.survive)) # okay, highly significant correlation between parasitoid abundance and abundances of LTFs when they are averaged across genotypes and wind exposure (i.e. 20 points)
View(windLM)
glm.LTF <- glm(LTF.survive~Wind.Exposure*Genotype+Block+Mature.Green.Leaves,family="poisson",aggLTF)
summary(glm.LTF)
anova(glm.LTF,test="Chisq") # marginally significant wind by genotype interaction.  Stronger main effects of genotype and wind exposure.
glm.LTF <- glm(LTF.survive~Wind.Exposure*Genotype+Block,family="poisson",aggLTF)
summary(glm.LTF)
anova(glm.LTF,test="Chisq") # marginally significant wind by genotype interaction.  Stronger main effects of genotype and wind exposure.
glm.LTF <- glm(LTF.survive~Wind.Exposure*Genotype+Block+Mature.Green.Leaves,family="poisson",aggLTF)
summary(glm.LTF)
anova(glm.LTF,test="Chisq") # marginally significant wind by genotype interaction.  Stronger main effects of genotype and wind exposure.
glm.LTF <- glm(LTF.survive/Mature.Green.Leaves~Wind.Exposure*Genotype+Block,family="poisson",aggLTF)
lm.LTF <- lm(LTF.survive/Mature.Green.Leaves~Wind.Exposure*Genotype+Block,family="poisson",aggLTF)
lm.LTF <- lm(LTF.survive/Mature.Green.Leaves~Wind.Exposure*Genotype+Block,aggLTF)
summary(lm.LTF)
with(aggLTF, hist(LTF.survive/Mature.Green.Leaves))
glm.LTF <- glm(LTF.survive~Wind.Exposure*Genotype+Block+Mature.Green.Leaves,family="poisson",aggLTF)
summary(glm.LTF)
anova(glm.LTF,test="Chisq") # marginally significant wind by genotype interaction.  Stronger main effects of genotype and wind exposure.
summary(glm.LTF)
glm.LTF <- glm(LTF.survive~Wind.Exposure*Genotype+Block+Mature.Green.Leaves,family="quasipoisson",aggLTF)
summary(glm.LTF) # probelm that most of my p-value estimates are close to 1???
anova(glm.LTF,test="Chisq") # marginally significant wind by genotype interaction.  Stronger main effects of genotype relative to wind exposure.  Density-mediated effect by some plant trait (leaf abundance by itself doesn't explain much).
glm.LTF <- glm(LTF.survive~Wind.Exposure*Genotype+Block+Mature.Green.Leaves,family="poisson",aggLTF)
summary(glm.LTF) # probelm that most of my p-value estimates are close to 1???
anova(glm.LTF,test="Chisq") # marginally significant wind by genotype interaction.  Stronger main effects of genotype relative to wind exposure.  Density-mediated effect by some plant trait (leaf abundance by itself doesn't explain much).
plot(glm.LTF)
plot(glm.LTF)
glm.LTF <- glm(LTF.survive~Wind.Exposure*Genotype+Block+Mature.Green.Leaves,family="quasipoisson",aggLTF)
summary(glm.LTF) # probelm that most of my p-value estimates are close to 1???  I feel like I have a zero-inflated dataset, but there doesn't appear to be overdispersion...Actually, the residuals don't look good at all.
anova(glm.LTF,test="Chisq") # marginally significant wind by genotype interaction.  Stronger main effects of genotype relative to wind exposure.  Density-mediated effect by some plant trait (leaf abundance by itself doesn't explain much).
plot(glm.LTF)
LTF.fixed <- glmer(LTF.survive~Wind.Exposure*Genotype + (1|Block), family="poisson", aggLTF)
summary(LTF.fixed)
anova(LTF.fixed)
LTF.fixed1 <- glmer(LTF.survive~Wind.Exposure+Genotype+(1|Block), family="poisson", aggLTF)
summary(LTF.fixed1)
anova(LTF.fixed,LTF.fixed1)
traitLTF <- merge(wind,aggLTF)
View(traitLTF)
head(traitLTF)
splom(LTF.survive~WC+LDMC+Trichome.Density+ShootTotal+Max.Height+Mature.Green.Leaves,traitLTF)
splom(~traitLTF|LTF.survive+WC+LDMC+Trichome.Density+ShootTotal+Max.Height+Mature.Green.Leaves)
with(traitLTF,splom(~traitLTF|LTF.survive+WC+LDMC+Trichome.Density+ShootTotal+Max.Height+Mature.Green.Leaves))
subset(traitLTF, select = c(LTF.survive,ShootTotal,Max.Height, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves))
subTraitLTF <- subset(traitLTF, select = c(LTF.survive,ShootTotal,Max.Height, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves))
splotm(subTraitLTF)
splom(subTraitLTF)
subTraitLTF <- subset(traitLTF, select = c(LTF.survive,ShootTotal,Max.Height, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves,Genotype,Wind.Exposure,Block))
splom(subTraitLTF) # may be a bit of relationship with the percent of leaf that is browned (indicator of water stress...)
aggTraitLTF <- aggregate(LTF.survive+ShootTotal+Max.Height+Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves~Genotype+WindExposure,FUN=mean,subTraitLTF)
head(subTraitLTF)
aggTraitLTF <- aggregate(LTF.survive+ShootTotal+Max.Height+Trichome.Density+LDMC+WC+Percent.Browned+Mature.Green.Leaves~Genotype+WindExposure,FUN=mean,subTraitLTF)
aggTraitLTF <- aggregate(LTF.survive+ShootTotal+Max.Height+Trichome.Density+LDMC+WC+Percent.Browned+Mature.Green.Leaves~Genotype+Wind.Exposure,FUN=mean,subTraitLTF)
aggTraitLTF
cor(subTraitLTF)
subTraitLTF <- subset(traitLTF, select = c(LTF.survive,ShootTotal,Max.Height, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves) #,Genotype,Wind.Exposure,Block))
cor(subTraitLTF)
subTraitLTF <- subset(traitLTF, select = c(LTF.survive,ShootTotal,Max.Height, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves)) #,Genotype,Wind.Exposure,Block))
cor(subTraitLTF)
with(subTraitLTF, cor.test(LTF.survive,Percent.Browned))
with(subTraitLTF, cor.test(LTF.survive, ShootTOtal))
with(subTraitLTF, cor.test(LTF.survive, ShootTotal))
with(subTraitLTF, cor.test(LTF.survive,Mature.Green.Leaves))
cor(subTraitLTF)
anova(brown.glm,test="Chisq") #strong effect of wind, and a slight interactive effect
with(wind,interaction.plot(Wind.Exposure,Genotype,Percent.Browned)) # clear interactive effect of wind exposure on percent of leaf that is browned.
with(wind,interaction.plot(Wind.Exposure,Genotype,Percent.Browned, col=1:10)) # clear interactive effect of wind exposure on percent of leaf that is browned.
with(aggLTF, interaction.plot(Treatment,Genotype,LTF.survive, col=1:10)) # abundance of LTF appears to increase at unexposed sites.
with(wind,interaction.plot(Wind.Exposure,Genotype,Percent.Browned, col=1:10)) # clear interactive effect of wind exposure on percent of leaf that is browned.
with(aggLTF, interaction.plot(Treatment,Genotype,LTF.survive, col=1:10)) # abundance of LTF appears to increase at unexposed sites.
aaLTF.glm <- glm(LTFsurvive~Genotype+Aphids.or.No.Aphids+Distant.to.Ant.Mound + Block,family="poisson",aggLTF) # if I try to include interactions, then I receive the warning "fitted rates numerically 0 occurred".
########################################################################################
##      Ant-Aphid by Genotype Experiment data analysis
########################################################################################
### Play around with "date" as a random effect (can I do this or am I violating some assumption?)
### Need to model aphid population growth, following Agrawal 2004
### Need to get herbivores organized.  Look at leaf bundlers and leaf tip folders, as well as homopterans.
## set working directory
setwd("~/Desktop/Lanphere Experiments/Ant-Aphid Experiment")
## load libraries
library("lattice")
library("lme4")
### upload data
# experimental design setup
setup <- read.csv("~/Desktop/Lanphere Experiments/Ant-Aphid Experiment/Ant-Aphid_Experiment_Setup.csv")
# arthropod data. NEED TO DOUBLE CHECK!!!
raw <- read.csv("~/Desktop/WillowProject/Ant-Aphid Experiment/Ant-Aphid_Data_v2.csv", stringsAsFactors=F)
# dissection data
LTFdata <- read.csv("~/Desktop/Lanphere Experiments/Ant-Aphid Experiment/Arthropod Dissections/Leaf Miner Dissections - Ant-Aphid Experiment 2012.csv", stringsAsFactors=F)
# plant trait data
trich <- read.csv("~/Desktop/Lanphere Experiments/Ant-Aphid Experiment/Plant Traits/Trichome Density - Ant-Aphid Experiment 2012.csv")
DryLeafWt <- read.csv("~/Desktop/Lanphere Experiments/Ant-Aphid Experiment/Plant Traits/Leaf Weights - Dry - Ant-Aphid Experiment 2012.csv")
WetLeafWt <- read.csv("~/Desktop/Lanphere Experiments/Ant-Aphid Experiment/Plant Traits/Ant-aphid Plant Trait Data.csv") # also has percent browning, but I don't know how informative it will be since we didn't take leaves from plants that had leaves that were substantially browned.
# merge and manage plant trait data
setup$Collection.No. <- with(setup, paste(Block,Plant.Position, sep="."))
setup$Zeroes <- seq(0,0,0) # create column with only zeroes
aaTrait <- merge(setup, trich, by="Collection.No.")
aaTrait <- merge(aaTrait, DryLeafWt, by="Collection.No.")
aaTrait <- merge(aaTrait, WetLeafWt, by.x = "Collection.No.", by.y="Collection.Number")
aaTrait <- subset(aaTrait, select = c(Genotype, Block, Distant.to.Ant.Mound, Plant.Position, Collection.No., Aphids.or.No.Aphids, Wet.Leaf.Weight, Percent.Browned, Trichome.Density.x, Dry.Leaf.Weight.x))
aaTrait$LDMC <- with(aaTrait, Dry.Leaf.Weight.x/Wet.Leaf.Weight)
aaTrait$WC <- with(aaTrait, (Wet.Leaf.Weight-Dry.Leaf.Weight.x)/Dry.Leaf.Weight.x)
# merge and manage Caloptilia dissection data
LTFdata$Collection.No. <- with(LTFdata, paste(Block,Plant, sep="."))
aaLTF <- merge(setup, LTFdata, by="Collection.No.")
emptyLTF <- grep("empty", aaLTF$Leaf.Tip.Fold)
aaLTF$Leaf.Tip.Fold <- replace(aaLTF$Leaf.Tip.Fold, emptyLTF,"LTFlarv") # changed all entries with "empty" to "LTFlarv" to indicate they survived.
aaLTF$LTFsurvive <- with(aaLTF, ifelse(aaLTF$Leaf.Tip.Fold == "LTFlarv", 1, 0))
############################ Exploratory Data Analysis ##############################
### Plant Traits
# leaf dry matter content (LDMC). Appears to be a major outlying point.
xyplot(LDMC~Distant.to.Ant.Mound+Aphids.or.No.Aphids, group = Genotype, aaTrait, type="l")
with(aaTrait,interaction.plot(Distant.to.Ant.Mound,Genotype,LDMC))
with(aaTrait, interaction.plot(Distant.to.Ant.Mound,Aphids.or.No.Aphids,LDMC))
with(aaTrait, interaction.plot(Aphids.or.No.Aphids,Genotype,LDMC))
LDMC.glm <- glm(LDMC~Genotype*Distant.to.Ant.Mound*Aphids.or.No.Aphids,aaTrait,family="gaussian")
summary(LDMC.glm)
anova(LDMC.glm,test="F") # appears to be a marginal main effect of distance to ant mound
# water content (WC).  Appears to be a major outlying point.
xyplot(WC~Distant.to.Ant.Mound+Aphids.or.No.Aphids,group=Genotype,aaTrait, type ="l")
WC.glm <- glm(WC~Genotype*Distant.to.Ant.Mound*Aphids.or.No.Aphids,aaTrait,family="gaussian")
summary(WC.glm)
anova(WC.glm,test="F") # wow...apparently there is a significant 3-way interaction
# trichome density. Lines are going crazy...
xyplot(Trichome.Density.x~Distant.to.Ant.Mound+Aphids.or.No.Aphids,group=Genotype,aaTrait, type = "l")
tri.glm <- glm(Trichome.Density.x~Genotype*Distant.to.Ant.Mound*Aphids.or.No.Aphids,aaTrait,family="poisson")
summary(tri.glm)
anova(tri.glm,test="Chisq") # wow...apparently there is ANOTHER significant 3-way interaction.  This seems a bit fishy to me...
### Caloptilia LTF larva abundance.
######### Still need to remove dead plants from analysis...
aggLTF <- aggregate(LTFsurvive~Collection.No.+Genotype+Distant.to.Ant.Mound+Aphids.or.No.Aphids, FUN=sum,aaLTF)
aggLTF <- merge(setup,aggLTF,all.x=T)
aggLTF$LTFsurvive[is.na(aggLTF$LTFsurvive)] <- 0 # change all of the NA's in the column to zero
with(aggLTF, table(Genotype,LTFsurvive) )
with(aggLTF, table(Distant.to.Ant.Mound,LTFsurvive))
with(aggLTF, table(Aphids.or.No.Aphids,LTFsurvive))
aaLTF.glm <- glm(LTFsurvive~Genotype+Aphids.or.No.Aphids+Distant.to.Ant.Mound + Block,family="poisson",aggLTF) # if I try to include interactions, then I receive the warning "fitted rates numerically 0 occurred".
summary(aaLTF.glm)
anova(aaLTF.glm,test="Chisq")
## check the data
str(raw)
## omit dead trees
raw$dead <- ifelse(raw$Notes == "dead", 1,0)
## new data columns
herbivores <- with(raw, Spittlebugs+Leaf.Tip.Folds..pre.July.14.category.+Leaf.Hoppers) # new data column with abundance of all herbivores added together.
ants <- with(raw, Red.Ants+Black.Ants) # new data column with abundance of all ants added together
## aggregated data
SumDead <- aggregate(dead ~ Unique.Number+Genotype+Distance.to.Ant.Mound+Aphid.Treatment+Block, FUN=sum,data=raw) #method has not reliably identified all dead trees.
strAvgHerb <- aggregate(herbivores ~ Unique.Number + Genotype + Distance.to.Ant.Mound + Aphid.Treatment + Block, FUN=mean, data=raw)
SumSpid <- aggregate(Spiders ~ Unique.Number + Genotype + Distance.to.Ant.Mound + Aphid.Treatment + Block, FUN=sum, data=raw)
SumRedAnts <- aggregate(Red.Ants ~ Unique.Number + Genotype + Distance.to.Ant.Mound + Aphid.Treatment + Block, FUN=sum, data=raw)
SumAphids <- aggregate(Green.Aphids ~ Unique.Number + Genotype + Distance.to.Ant.Mound + Aphid.Treatment + Block, FUN=sum, data=subset(raw, Aphid.Treatment = "aphid"))
MaxLTF <- aggregate(Leaf.Tip.Folds..pre.July.14.category.~Unique.Number + Genotype + Distance.to.Ant.Mound + Aphid.Treatment + Block, FUN=max, data=raw)
## data currently in use for analysis
data <- cbind(SumAphids,SumDead$dead)
data <- subset(data, SumDead$dead < 1)
data <- subset(data, Aphid.Treatment == "aphid")
## Effect on Aphid Abundance
bwplot(Green.Aphids ~ as.factor(Genotype), data=data)
xyplot(Green.Aphids ~ as.numeric(Distance.to.Ant.Mound), type = "a", data=data)
with(data, interaction.plot(Distance.to.Ant.Mound,Genotype,Green.Aphids, col=1:10, ylab="Green Aphid Abundance"))
glm.aphid <- glm(Green.Aphids ~ Genotype*Distance.to.Ant.Mound, data, family=quasipoisson)
summary(glm.aphid) # note that the dispersion factor is incredibly high (likely due to high aphid mortality.  Maybe I should convert this into aphid population growth rates...)
anova(glm.aphid, test="Chisq")
## Effect on Red Ant abundance
bwplot(Red.Ants ~ as.factor(Genotype), data=data)
bwplot(Red.Ants ~ as.factor(Aphid.Treatment), data=data)
xyplot(Red.Ants ~ as.numeric(Distance.to.Ant.Mound), type = "a", data=data)
xyplot(Red.Ants ~ as.numeric(Distance.to.Ant.Mound), group = Aphid.Treatment, type = "a", data=data, auto.key=T)
xyplot(Red.Ants ~ as.numeric(Distance.to.Ant.Mound), group = Genotype, type = "a", data=data, auto.key=T)
xyplot(Red.Ants ~ as.numeric(Distance.to.Ant.Mound) + as.factor(Aphid.Treatment), group = Genotype, type = "a", data=data)
# Mixed effect model
(RedAnt.full <- glmer(Red.Ants ~ as.numeric(Distance.to.Ant.Mound)*as.factor(Aphid.Treatment)*as.factor(Genotype) + (1|Block), family = poisson, data=data)) # Full model. Warning message that glm fitted rates numerically 0 occurred
(RedAnt.null <- glmer(Red.Ants ~ (1|Block), family = poisson, data=data))
## Effects on leaf tip folder abundance
# visualize leaf tip folder abundance
bwplot(Leaf.Tip.Folds..pre.July.14.category.~Genotype, data=MaxLTF)
xyplot(Leaf.Tip.Folds..pre.July.14.category.~as.factor(Aphid.Treatment), group = Genotype, type = "a", data=MaxLTF)
xyplot(Leaf.Tip.Folds..pre.July.14.category.~as.numeric(Distance.to.Ant.Mound), group = Genotype, type = "a", data=MaxLTF)
(LTF.full <- glmer(Leaf.Tip.Folds..pre.July.14.category.~as.numeric(Distance.to.Ant.Mound)*as.factor(Aphid.Treatment)*as.factor(Genotype) + (1|Block), family = poisson, data=MaxLTF))
(LTF.geno <- glmer(Leaf.Tip.Folds..pre.July.14.category.~as.factor(Genotype) + (1|Block), family = poisson, data=MaxLTF))
(LTF.null <- glmer(Leaf.Tip.Folds..pre.July.14.category.~ (1|Block), family = poisson, data=MaxLTF))
## Visualize the Spider data
bwplot(Spiders ~ as.factor(Genotype), data=data) # effect of distance to ant mound and genotype on herbivore abundance
xyplot(Spiders ~ as.factor(Aphid.Treatment) + as.numeric(Distance.to.Ant.Mound), group = Genotype, type = "a", data=data) # effect of genotype's interaction with aphid treatment and distance to ant mound on spider abundance
## Effect of treatments on Spider abundance. Genotype alone as well as Genotype's separate interactions with aphid treatment and distance to ant mound appear to be the best models
(spid.full <- glmer(Spiders ~ as.numeric(Distance.to.Ant.Mound)*as.factor(Aphid.Treatment)*as.factor(Genotype) + (1|Block), family = poisson, data=data)) # Full model
(spid.aphidDist <- glmer(Spiders ~ as.factor(Aphid.Treatment)*as.numeric(Distance.to.Ant.Mound) + (1|Block), family = poisson, data=data)) # aphid by distance to ant mound interaction
(spid.genAphid <- glmer(Spiders ~ as.factor(Aphid.Treatment)*as.factor(Genotype) + (1|Block), family = poisson, data=data)) # aphid by genotype interaction
(spid.genDist <- glmer(Spiders ~ as.numeric(Distance.to.Ant.Mound)*as.factor(Genotype) + (1|Block), family = poisson, data=data)) # distance by genotype interaction
(spid.geno <- glmer(Spiders ~ as.factor(Genotype) + (1|Block), family = poisson, data=data)) # only genotype
(spid.dist <- glmer(Spiders ~ as.numeric(Distance.to.Ant.Mound) + (1|Block), family = poisson, data=data)) # only distance to ant mound
(spid.aphid <- glmer(Spiders ~ as.factor(Aphid.Treatment) + (1|Block), family = poisson, data=data)) # only aphid treatment
(spid.null <-  glmer(Spiders ~ (1|Block), family = poisson, data=data)) # null model
## Effect of date and genotype on herbivores
xyplot(herbivores ~ as.numeric(relative.Date), group = Genotype, type = "a", data=raw)
## Effect of data and ant mound distance on herbivores
xyplot(herbivores ~ as.numeric(relative.Date), group = Distance.to.Ant.Mound, type = "a", data=raw)
# testing out a mixed effects models
lme1 <- lmer(herbivores ~ as.factor(Genotype) + (as.factor(Genotype) | Block), data = data)
lme2 <- lmer(herbivores ~ as.factor(Genotype) + (1 | Block), data = data)
anova(lme1, lme2)
################### OLD ################################
## added data
data$PredAbund <- with(data, X._Spiders+X._Fly_Predators+X._Chalcid_Parasitoids + X._Other_Predators)
data$OtherHerbAbund <- with(data, X._Beetles+X._Spittlebugs+X._Leaf_Tip_Folds+X._Leaf_Bundlers+X._Tent_Mines + X._Leaf_Edge_Roller+X._Leaf_Hopper+X._Other_Herbivores)
data$AntAbund <- with(data, X._Red_Ants+X._Black_Ants)
## aphid data only
aphid <- subset(data, Aphid_Treatment == "aphid")
aphid.NoG <- subset(aphid, Genotype != "G")
## cuttings with at least one aphid
OnePlusAphid <- subset(aphid, X._Green_Aphids > 0)
## Exploratory data analysis
hist(OnePlusAphid$X._Green_Aphids, right =T)
hist(aphid$X._Red_Ants, right =T)
hist(aphid$X._Black_Ants, right = T)
## Effect of Genotype on aphids. GENOTYPE G APPEARS TO BE DRIVING THE GENOTYPE EFFECT ON APHID ABUNDANCE BECAUSE THERE WERE NEVER ANY APHIDS ON G.
plot(X._Green_Aphids~as.factor(Genotype), data=OnePlusAphid)
glm.Aphids <- glm(X._Green_Aphids~as.factor(Genotype), data=OnePlusAphid, family=quasipoisson)
sum.Aphids <- summary(glm.Aphids)
anova(glm.Aphids, test = "F")
## Effect of ant mound distance and genotype on aphids
xyplot(X._Green_Aphids~as.numeric(Distance_to_Ant_Mound), group = Genotype, type = "a", data=aphid)
glm.Inter <- glm(X._Green_Aphids ~ as.factor(Genotype) * as.numeric(Distance_to_Ant_Mound), data = aphid, family = quasipoisson)
sum.Inter <- summary(glm.Inter)
anova(glm.Inter, test = "F")
## Effect of ant mound distance on red ants
xyplot(X._Red_Ants ~ Distance_to_Ant_Mound, groups = Aphid_Treatment, data = data)
glm.Ant <- glm(X._Red_Ants ~ Distance_to_Ant_Mound * Aphid_Treatment, data = data, family = quasipoisson)
sum.Ant <- summary(glm.Ant)
## Effect of red ants on black ant abundance
xyplot(X._Black_Ants ~ X._Red_Ants, data=data)
## Effect of red ants on abundance of all predators
xyplot(PredAbund ~ X._Red_Ants, data=data)
## Effect of black ants on abundance of all predators
xyplot(PredAbund ~ X._Black_Ants, data=data)
## Effect of red ants on herbivore abundance
xyplot(OtherHerbAbund~X._Red_Ants, data=data)
## Effect of black ants on herbivore abundance
xyplot(OtherHerbAbund~X._Black_Ants, data=data)
## Effect of red ants on aphid abundance
xyplot(X._Green_Aphids ~ X._Red_Ants, data=data)
## Effect of black ants on aphid abundance
xyplot(X._Green_Aphids ~ X._Black_Ants, data=data)
## Effect of all ants on aphid abundance
xyplot(X._Green_Aphids ~ AntAbund, data=data)
with(data, cor.test(X._Green_Aphids, AntAbund))
## Effect of data on aphid abundance
xyplot(X._Green_Aphids ~ as.factor(Date), data=data)
aaLTF.glm <- glm(LTFsurvive~Genotype+Aphids.or.No.Aphids+Distant.to.Ant.Mound + Block,family="poisson",aggLTF) # if I try to include interactions, then I receive the warning "fitted rates numerically 0 occurred".
summary(aaLTF.glm)
anova(aaLTF.glm,test="Chisq")
aaLTF.glm <- glm(LTFsurvive~Genotype+Aphids.or.No.Aphids+Distant.to.Ant.Mound + Block + Mature.Green.Leaves,family="poisson",aggLTF) # if I try to include interactions, then I receive the warning "fitted rates numerically 0 occurred".
aaLTF.glm <- glm(LTFsurvive~Genotype*Aphids.or.No.Aphids*Distant.to.Ant.Mound + Block,family="poisson",aggLTF) # if I try to include interactions, then I receive the warning "fitted rates numerically 0 occurred".
summary(aaLTF.glm)
anova(aaLTF.glm,test="Chisq") # genotype, but not other factor, has a significant effect on LTF larva abundance.
traitLTF <- merge(aggLTF,aaTrait)
head(traitLTF)
AAtraitLTF <- merge(aggLTF,aaTrait)
subTraitLTF <- subset(AAtraitLTF, select = c(LTFsurvive, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves)))
subTraitLTF <- subset(AAtraitLTF, select = c(LTFsurvive, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves))
subTraitLTF <- subset(AAtraitLTF, select = c(LTFsurvive, Trichome.Density.x,LDMC,WC,Percent.Browned,Mature.Green.Leaves))
subTraitLTF <- subset(AAtraitLTF, select = c(LTFsurvive, Trichome.Density.x,LDMC,WC,Percent.Browned))
splom(subTraitLTF)
cor(subTraitLTF)
subAAtraitLTF <- subset(AAtraitLTF, select = c(LTFsurvive, Trichome.Density.x,LDMC,WC,Percent.Browned))
splom(subAAtraitLTF)
cor(subAAtraitLTF)
with(subAAtraitLTF, cor.test(LTFsurvive,LDMC))
traitLTF <- merge(wind,aggLTF)
subTraitLTF <- subset(traitLTF, select = c(LTF.survive,ShootTotal,Max.Height, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves)) #,Genotype,Wind.Exposure,Block))
subTraitLTF <- subset(traitLTF, select = c(LTF.survive,ShootTotal,Max.Height, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves)) #,Genotype,Wind.Exposure,Block))
######### Need to update data sheet with twisty gall, stem gall, sawfly, etc. abundances
######### Interesting pattern: wind exposed plants attract light green aphids [which is a pattern I thoght I was observing in the field as well].  Need to think about the story behind this...[would need to remove aphids to test for interactive effects on senescence]
######## Calculate degree of stress? Difference between average number of mature leaves per shoot on unexposed genotype and observed number of mature leaves per shoot.  I could also use the percent browned leaf as well as whether or not a leaf was even collected from the plant. Or difference between average number of mature leaves on unexposed genotype and observed number of mature leaves.
# set working directory
setwd("~/Desktop/Lanphere Experiments/Wind Experiment")
# load libraries
library("lattice")
library("lme4")
library("nlme")
library("reshape2")
# load data
WindData <- read.csv("~/Desktop/Lanphere Experiments/Wind Experiment/Visual Arthropod Surveys & Plant Architecture Data/Wind Plant Trait and Arthropod data.csv")
Wind.leaf.trait.data <- read.csv("~/Desktop/Lanphere Experiments/Wind Experiment/Plant Traits/Wind leaf trait data.csv")
trichomes <- read.csv("~/Desktop/Lanphere Experiments/Wind Experiment/Plant Traits/Trichome Density - Wind Experiment 2012.csv")
DryLeafWt <- read.csv("~/Desktop/Lanphere Experiments/Wind Experiment/Plant Traits/Leaf Weights - Dry - Wind Experiment 2012.csv")
WindLeafMine <- read.csv("~/Desktop/Lanphere Experiments/Wind Experiment/Arthropod Dissections/Leaf Miner Dissections - Wind Experiment 2012.csv", stringsAsFactors=F)
WindLeafTiesOthers <- read.csv("~/Desktop/Lanphere Experiments/Wind Experiment/Arthropod Dissections/Leaf Ties - Wind Experiment 2012.csv")
### manage data
# manage wind data
WindData$Wind.Exposure <- factor(x = WindData$Wind.Exposure, levels = c("Exposed","Unexposed"), labels = c("e","u"))
WindData$Collection.Number <- with(WindData, paste(Wind.Exposure,Block,sep=""))
WindData$Collection.Number <- with(WindData, paste(Collection.Number,Plant.Position,sep="."))
WindLeafMine$Collection.Number <- with(WindLeafMine, paste(Treatment,Block,sep=""))
WindLeafMine$Collection.Number <- with(WindLeafMine, paste(Collection.Number,Plant, sep="."))
WindLeafTiesOthers$Collection.Number <- with(WindLeafTiesOthers, paste(Treatment,Block,sep=""))
WindLeafTiesOthers$Collection.Number <- with(WindLeafTiesOthers, paste(Collection.Number,Plant, sep="."))
# merge and manage data sets
wind <- merge(WindData,Wind.leaf.trait.data,by.x="Collection.Number",by.y="Collection.Number")
wind <- merge(wind,trichomes,by.x="Collection.Number", by.y="Collection.No.")
wind <- merge(wind,DryLeafWt, by.x="Collection.Number", by.y="Collection.No.")
#wind <- merge(wind,WindLeafMine, by.x="Collection.Number", by.y="Collection.Number") # noticed that I lost data Leaf miner data when I merged these data set
wind$LDMC <- with(wind, Dry.Leaf.Wt/Wet.Leaf.Weight)
wind$WC <- with(wind, (Wet.Leaf.Weight-Dry.Leaf.Wt)/Dry.Leaf.Wt)
# manage leaf mine parasitism data
windLM <- merge(WindLeafMine, WindData, by="Collection.Number")
empty <- grep("empty", windLM$Leaf.Tip.Fold)
windLM$Leaf.Tip.Fold <- replace(windLM$Leaf.Tip.Fold, empty,"LTFlarv") # changed all entries with "empty" to "LTFlarv" to indicate they survived.
sp.329 <- grep("329", windLM$Leaf.Tip.Fold)
windLM$Leaf.Tip.Fold <- replace(windLM$Leaf.Tip.Fold, sp.329, "sp.329") # changed all entries with "329" to "sp.329" to indicate they were parasitized by sp. 329.
windLM$LTF.survive <- with(windLM, ifelse(Leaf.Tip.Fold == "LTFlarv", 1,0))
windLM$sp329.attack <- with(windLM, ifelse(Leaf.Tip.Fold == "sp.329",1,0))
# manage leaf tie and other parasitism data
windOther <- merge(WindLeafTiesOthers,WindData,by="Collection.Number")
windOther$live319 <- with(windOther, ifelse(Contents == "living 319", 1,0))
windOther$live320 <- with(windOther, ifelse(Contents == "living 320", 1,0))
windOther$live321 <- with(windOther, ifelse(Contents == "living 321", 1,0))
windOther$live322 <- with(windOther, ifelse(Contents == "living 322", 1,0))
WindData$ShootTotal <- with(WindData, X1.shoot.M+X2.shoot.M+X3.shoot.M+X4.shoot.M+X5.shoot.M+X6.shoot.M+X7.shoot.M+X8.shoot.M+X9.shoot.M+X10.shoot.M)
WindData$LeavesPerSL <- with(WindData,Mature.Green.Leaves/ShootTotal)
WindData$SpidTot <- with(WindData, Spiders.black.with.yellow.legs+Spiders.Other)
WindData$lacewingEggs <- WindData$Parisatoid.cocoons.on.Aphids
WindData$LH <- with(WindData, Leaf.Hoppers.Blue.Brown+Leaf.Hoppers.Camo+LH.nymph.blk.ylw+LH.nymph.other)
WindData$AphidLoad <- with(WindData,Light.Green.Aphids/Mature.Green.Leaves)
################### Exploratory Data Analysis #############################
# GxE effect on Percent browning.  Probably need to redo the analysis by treating them as random effects
with(wind,interaction.plot(Wind.Exposure,Genotype,Percent.Browned, col=1:10)) # clear interactive effect of wind exposure on percent of leaf that is browned.
brown.glm <- glm(Percent.Browned~Wind.Exposure*Genotype,wind,family="gaussian")
summary(brown.glm)
anova(brown.glm,test="Chisq") #strong effect of wind, and a slight interactive effect
# GxE effect on Trichome density. Probably need to redo the analysis by treating them as random effects
with(wind,interaction.plot(Wind.Exposure,Genotype,Trichome.Density)) # clear genotype effect on trichome density
tri.glm <- glm(Trichome.Density~Wind.Exposure*Genotype,wind,family="quasipoisson")
summary(tri.glm)
anova(tri.glm,test="Chisq") # large effect of plant genotype
# GxE effect on Leaf Dry Matter Content (LDMC)
with(wind,interaction.plot(Wind.Exposure,Genotype,LDMC))
LDMC.glm <- glm(LDMC~Wind.Exposure*Genotype,wind,family="gaussian")
summary(LDMC.glm)
anova(LDMC.glm,test="F") # appears to be a marginal main effect of genotype and wind exposure
# GxE effect on water content (WC) of leaves
with(wind, interaction.plot(Wind.Exposure,Genotype,WC))
WC.glm <- glm(WC~Wind.Exposure*Genotype,wind,family="gaussian")
summary(WC.glm)
anova(WC.glm, test="F") # appears to be a marginal main effect of wind exposure, but higher water content at exposed sites???
# GxE effect on leaf tip folder survival. Still not accounting for other stages or parasitism. Concerned about analyzing "glmer" models.  Not accounting for density (per leaf), simply abundance.
aggLTF <- aggregate(LTF.survive~Collection.Number+Genotype+Treatment,FUN=sum, windLM)
aggLTF <- merge(WindData,aggLTF, all.x=T)
aggLTF$LTF.survive[is.na(aggLTF$LTF.survive)] <- 0 # change all of the NA's in the column to zero
with(aggLTF, interaction.plot(Treatment,Genotype,LTF.survive, col=1:10)) # abundance of LTF appears to increase at unexposed sites.
LTF.1 <- glmer(LTF.survive~Wind.Exposure + (1|Genotype) + (1|Block),family="poisson",aggLTF)
summary(LTF.1)
LTF.2 <- glmer(LTF.survive~Wind.Exposure + (Block|Genotype), family="poisson", aggLTF)
anova(LTF.1,LTF.2) # suggests that there is a block by genotype interaction?
LTF.null <- glmer(LTF.survive~(Block|Genotype), family="poisson",aggLTF)
anova(LTF.null,LTF.1) # suggest that wind exposure has a vary strong effect
summary(LTF.2)
LTF.random <- glmer(LTF.survive~(1|Wind.Exposure)+(1|Genotype)+(1|Block), family="poisson", aggLTF)
summary(LTF.random) # block has no variance explained???
LTF.fixed2 <- glmer(LTF.survive~Wind.Exposure*Genotype + (1|Block), family="poisson", aggLTF)
summary(LTF.fixed)
LTF.fixed1 <- glmer(LTF.survive~Wind.Exposure+Genotype+(1|Block), family="poisson", aggLTF)
summary(LTF.fixed1)
anova(LTF.fixed,LTF.fixed1) # again, marginally significant effect of including the interaction term
glm.LTF <- glm(LTF.survive~Wind.Exposure*Genotype+Block+Mature.Green.Leaves,family="poisson",aggLTF)
summary(glm.LTF) # probelm that most of my p-value estimates are close to 1???  I feel like I have a zero-inflated dataset, but there doesn't appear to be overdispersion...Actually, the residuals don't look good at all.
anova(glm.LTF,test="Chisq") # marginally significant wind by genotype interaction.  Stronger main effects of genotype relative to wind exposure.  Density-mediated effect by some plant trait (leaf abundance by itself doesn't explain much).
# look for correlations between plant traits and LTF abundance
traitLTF <- merge(wind,aggLTF)
subTraitLTF <- subset(traitLTF, select = c(LTF.survive,ShootTotal,Max.Height, Trichome.Density,LDMC,WC,Percent.Browned,Mature.Green.Leaves)) #,Genotype,Wind.Exposure,Block))
splom(subTraitLTF) # may be a bit of relationship with the percent of leaf that is browned (indicator of water stress...)
cor(subTraitLTF) # why is nothing showing up with Mature.Green.Leaves???  Note that LDMC and WC are highly correlated (as expected)
with(subTraitLTF, cor.test(LTF.survive,Percent.Browned)) # significant negative correlation between these two parameters
with(subTraitLTF, cor.test(LTF.survive, ShootTotal)) # marginally significant positive correlation between these two parameters
with(subTraitLTF, cor.test(LTF.survive,Mature.Green.Leaves)) # significant positive correlation between these two parameters
# GxE effect on parasitoid sp. 329 abundance.  Right now, I think my abundances are too low for at least the LTFs.
agg329 <- aggregate(sp329.attack~Collection.Number+Genotype+Treatment,FUN=sum,windLM)
with(agg329, interaction.plot(Treatment,Genotype,sp329.attack)) # no clear effect...
with(agg329, table(Treatment,Genotype,sp329.attack))
agg329 <- merge(WindData,agg329, all.x=T)
agg329$sp329.attack[is.na(agg329$sp329.attack)] <- 0 # change all of the NA's in the column to zero
glm.329 <- glm(sp329.attack~Genotype*as.factor(Treatment)+Block,family="poisson",agg329)
summary(glm.329) # problem that estimates are close to 1
anova(glm.329,test="Chisq") # I suspect that my abundances are too low to detect any effects
# explore relationship between abundance of LTF and sp. 329
LTF.329 <- merge(aggLTF,agg329)
aggLTFcorr <- aggregate(LTF.survive ~ Genotype + Wind.Exposure, FUN=mean, LTF.329)
agg329corr <- aggregate(sp329.attack~Genotype+Wind.Exposure,FUN=mean,LTF.329)
LTF.329corr <- merge(aggLTFcorr,agg329corr)
plot(sp329.attack~LTF.survive,LTF.329corr)
with(LTF.329corr, cor.test(sp329.attack,LTF.survive)) # okay, highly significant correlation between parasitoid abundance and abundances of LTFs when they are averaged across genotypes and wind exposure (i.e. 20 points)
# GxE effect on morphospecies 319, 320, 321 abundance. Don't know how the stage structure will work for this population.  But can I argue that it is stage structured?  I do have what appear to be "in-between" stages of larva.
agg319 <- aggregate(live319~Collection.Number+Genotype+Treatment,FUN=sum,windOther)
with(agg319, interaction.plot(Treatment,Genotype,live319))
glm.319 <- glm(live319~Genotype*as.factor(Treatment),family="poisson",agg319)
summary(glm.319)
anova(glm.319, test="Chisq") # I wonder why there is a significant interactive effect...
agg320 <- aggregate(live320~Collection.Number+Genotype+Treatment,FUN=sum,windOther)
with(agg320, interaction.plot(Treatment,Genotype,live320))
glm.320 <- glm(live320~Genotype*as.factor(Treatment),family="poisson",agg320)
summary(glm.320)
anova(glm.320, test="Chisq") # no effect for sp. 320
agg321 <- aggregate(live321~Collection.Number+Genotype+Treatment,FUN=sum,windOther)
with(agg321, interaction.plot(Treatment,Genotype,live321))
glm.321 <- glm(live321~Genotype*as.factor(Treatment),family="poisson",agg321)
summary(glm.321)
anova(glm.321, test="Chisq") # no effect for sp. 321
agg322 <- aggregate(live322~Collection.Number+Genotype+Treatment,FUN=sum,windOther)
with(agg322, interaction.plot(Treatment,Genotype,live322))
glm.322 <- glm(live322~Genotype*as.factor(Treatment),family="poisson",agg322)
summary(glm.322)
anova(glm.322, test="Chisq") # no effect for sp. 322
# data sets
data <- WindData
omitDead <- subset(WindData,Dead.!=1)
ltrait <- Wind.leaf.trait.data
WindDissect
# Parasitism.  At present the rate of parasitism didn't vary between treatments, but is simply a function of LTF/LEF density.
with(WindDissect, table(LTF.Parasitized,Treatment))
with(WindDissect, table(LEF.Parasitized,Treatment))
# Percent of collected leaf browned
plot(Percent.Browned~Treatment,ltrait, ylab = "Percent of Leaf Browned") # "w" category was for a leaf from an unknown treatment.
# Survival
with(data,table(Dead.,Genotype,Wind.Exposure))
death.glm <- glm(Dead.~Genotype*Wind.Exposure+Block,family=binomial,data)
summary(death.glm)
anova(death.glm,test="Chisq")
# Shoot Total Length
par(mar=c(5,5,4,2))
with(omitDead, interaction.plot(Wind.Exposure,Genotype,ShootTotal,fun=mean,type="l", col=1:10, legend=F, xlab="",ylab="Shoot Growth (cm)", cex.axis=1.5, cex.lab=1.5, lwd=3)) # shoot growth = sum of all shoot distances measured
shoot.lm <- lm(ShootTotal~Genotype*Wind.Exposure+Block,omitDead) # don't know if this is coded correctly
summary(shoot.lm)
anova(shoot.lm)
# Number of Mature Leaves
with(subset(omitDead,Mature.Green.Leaves > 0), interaction.plot(Wind.Exposure,Genotype,Mature.Green.Leaves,fun=mean, col=1:10, ylab="Number of Mature Leaves"))
MGL.lm <- lm(Mature.Green.Leaves~Wind.Exposure*Genotype+Block,omitDead)
summary(MGL.lm)
anova(MGL.lm) # interactive effect on the number of mature green leaves. Why?
# Number of Mature Leaves per shoot length
with(subset(omitDead,LeavesPerSL > 0), interaction.plot(Wind.Exposure,Genotype,LeavesPerSL,fun=mean, col=1:10)) #still not working...
LeavesPerSL.lm <- lm(LeavesPerSL~Genotype*Wind.Exposure+Block,omitDead)
summary(LeavesPerSL.lm)
anova(LeavesPerSL.lm) # Stronger effect of plant genotype
# Plant Height
with(omitDead, interaction.plot(Wind.Exposure,Genotype,Max.Height,fun=mean, col=1:10))
height.lm <- lm(Max.Height~Genotype*Wind.Exposure+Block,WindData)
summary(height.lm)
anova(height.lm)  # relatively stronger effect of host genotype
# Spider Abundance
with(omitDead,interaction.plot(Wind.Exposure,Genotype,SpidTot,fun=mean, col=1:10))
spid.glm <- glm(SpidTot~Wind.Exposure*Genotype+Block,omitDead,family=poisson)
summary(spid.glm)
anova(spid.glm,test="Chisq")
# Light Green Aphid Abundance
with(omitDead,interaction.plot(Wind.Exposure,Genotype,Light.Green.Aphids,fun=mean,col=1:10, ylab = "Light Green Aphid Abundance"))
plot(Light.Green.Aphids~Wind.Exposure,omitDead)
plot(Light.Green.Aphids~Mature.Green.Leaves,omitDead)
plot(Light.Green.Aphids~LeavesPerSL,omitDead)
aphid.glm <- glm(Light.Green.Aphids~Wind.Exposure*Genotype+Block,omitDead,family=quasipoisson)
summary(aphid.glm)
anova(aphid.glm,test="Chisq") # wind expsoure and block have a significant effect on light.green.aphid abundance.
plot(aphid.glm)  # quasipoisson is a much better model
anova(aphid.glm2,test="Chisq")
# Light green aphid "load" (number per mature green leaves)
with(omitDead,interaction.plot(Wind.Exposure,Genotype,AphidLoad,fun=mean,col=1:10)) # not really working...
aphidload <- lm(AphidLoad~Wind.Exposure*Genotype,omitDead)
summary(aphidload)
anova(aphidload) # still a significant effect of wind, but not much else.  In other words, the number of mature green leaves doesn't appear to have much consequence on the number of aphids [but perhaps stress?]
# Lacewing eggs
with(omitDead,interaction.plot(Wind.Exposure,Genotype,lacewingEggs,fun=mean,col=1:10))
lacewing.glm <- glm(lacewingEggs~Wind.Exposure*Genotype+Block,omitDead,family=poisson)
summary(lacewing.glm)
anova(lacewing.glm,test="Chisq") # genotype effect on lacewing egg abundance.  However, these abundances are quite low...
# Leafhoppers Blue-Brown. No other leaf hopper morphospecies or nymphs occurred during the survey
with(omitDead,interaction.plot(Wind.Exposure,Genotype,Leaf.Hoppers.Blue.Brown,fun=mean,col=1:10)) # very few in abundance
# Ants
with(omitDead,interaction.plot(Wind.Exposure,Genotype,Black.Ants,fun=mean,col=1:10)) # very few in abundance
splom(subTraitLTF) # may be a bit of relationship with the percent of leaf that is browned (indicator of water stress...)
cor(subTraitLTF) # why is nothing showing up with Mature.Green.Leaves???  Note that LDMC and WC are highly correlated (as expected)
with(subAAtraitLTF, cor.test(LTFsurvive,Percent.Browned))
with(subAAtraitLTF, cor.test(LTFsurvive,LDMC)) # highly significant.  Remember though that my data is NON-NORMAL
anova(LDMC.glm,test="F") # appears to be a marginal main effect of distance to ant mound
xyplot(LDMC~Distant.to.Ant.Mound+Aphids.or.No.Aphids, group = Genotype, aaTrait, type="l")
with(aaTrait,interaction.plot(Distant.to.Ant.Mound,Genotype,LDMC))
with(aaTrait, interaction.plot(Distant.to.Ant.Mound,Aphids.or.No.Aphids,LDMC))
with(aaTrait, interaction.plot(Aphids.or.No.Aphids,Genotype,LDMC))
LDMC.glm <- glm(LDMC~Genotype*Distant.to.Ant.Mound*Aphids.or.No.Aphids,aaTrait,family="gaussian")
summary(LDMC.glm)
anova(LDMC.glm,test="F") # appears to be a marginal main effect of distance to ant mound
with(aaTrait, table(Genotype,Distant.to.Ant.Mound,Aphids.or.No.Aphids))
with(aaTrait, table(Genotype))
