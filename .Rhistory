coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
#scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response, ncol=1, scales = "free_y", drop = TRUE) +
theme_cowplot()
filter(var.df, Response %in% c("Aphis farinosa","Formica obscuripes")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2), labels=c(0, 5, 10, 15, 20)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
filter(var.df, Response %in% c("Aphis farinosa","Formica obscuripes")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2), labels=c(0, 5, 10, 15, 20)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
filter(var.df, Response %in% c("Aphis farinosa","Formica obscuripes")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.05, 0.1, 0.15, 0.2), labels=c(0, 5, 10, 15, 20)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
filter(var.df, Year == "2013", Response %in% c("Leaf Water Content","SLA","Leaf C:N","Root C:N","Plant Height","Shoot Count","Shoot Length")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
#scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response, scales = "free_y") +
theme_cowplot()
traits.2013 <- filter(var.df, Year == "2013", Response %in% c("Leaf Water Content","SLA","Leaf C:N","Root C:N","Plant Height","Shoot Count","Shoot Length"))
traits.2013 <- filter(var.df, Year == "2013", Response %in% c("Leaf Water Content","SLA","Leaf C:N","Root C:N","Plant Height","Shoot Count","Shoot Length"))
trait.2013$Response_ord <- factor(trait.2013$Response, c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "Specific Leaf Area", "Leaf C:N", "Root C:N"))
ggplot(trait.2013, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
#scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
traits.2013 <- filter(var.df, Year == "2013", Response %in% c("Leaf Water Content","SLA","Leaf C:N","Root C:N","Plant Height","Shoot Count","Shoot Length"))
traits.2013$Response_ord <- factor(trait.2013$Response, c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "Specific Leaf Area", "Leaf C:N", "Root C:N"))
ggplot(traits.2013, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
#scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
traits.2013$Response_ord <- factor(trait.2013$Response, c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "SLA", "Leaf C:N", "Root C:N"))
ggplot(traits.2013, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
#scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
traits.2013$Response_ord <- factor(trait.2013$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "SLA", "Leaf C:N", "Root C:N"))
traits.2013 <- filter(var.df, Year == "2013", Response %in% c("Leaf Water Content","SLA","Leaf C:N","Root C:N","Plant Height","Shoot Count","Shoot Length"))
traits.2013$Response_ord <- factor(traits.2013$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "SLA", "Leaf C:N", "Root C:N"))
ggplot(traits.2013, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
#scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
ggplot(traits.2013, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.2, 0.4, 0.6), labels=c(0, 20, 40, 60)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
filter(var.df, Response == "Arthropod Richness") %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Experiment_Year, ncol=1, scales = "free_y") +
theme_cowplot()
filter(var.df, Response %in% c("Fungi Rarefied Richness","Bacteria Rarefied Richness")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
filter(var.df, Response %in% c("Aphis farinosa","Formica obscuripes")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.05, 0.1, 0.15, 0.2), labels=c(0, 5, 10, 15, 20)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
filter(var.df, Year == "2012", Response %in% c("Trichome Density","Leaf Water Content","SLA","Plant Height","Shoot Count","Shoot Length")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
#scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_grid(Experiment_Year~Response, scales = "free_y") +
theme_cowplot()
traits.aa.2012 <- filter(var.df, Experiment_Year == "Ant-Aphid 2012", Response %in% c("Leaf Water Content","SLA","Leaf C:N","Root C:N","Plant Height","Shoot Count","Shoot Length"))
traits.aa.2012$Response_ord <- factor(traits.aa.2012$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "SLA", "Leaf C:N", "Root C:N"))
ggplot(traits.aa.2012, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.2, 0.4, 0.6), labels=c(0, 20, 40, 60)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
traits.aa.2012 <- filter(var.df, Experiment_Year == "Ant-Aphid 2012", Response %in% c("Leaf Water Content","Trichome Density","Plant Height","Shoot Count","Shoot Length"))
traits.aa.2012$Response_ord <- factor(traits.aa.2012$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "Trichome Density"))
ggplot(traits.aa.2012, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.2, 0.4, 0.6), labels=c(0, 20, 40, 60)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
traits.w.2012 <- filter(var.df, Experiment_Year == "Wind 2012", Response %in% c("Leaf Water Content","Trichome Density","Plant Height","Shoot Count","Shoot Length"))
traits.w.2012$Response_ord <- factor(traits.w.2012$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "Trichome Density"))
ggplot(traits.w.2012, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.2, 0.4, 0.6), labels=c(0, 20, 40, 60)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
filter(var.df, Response == "Arthropod Richness") %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Experiment_Year, ncol=1, scales = "free_y") +
theme_cowplot()
filter(var.df, Response %in% c("Fungi Rarefied Richness","Bacteria Rarefied Richness")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_microbe_GxE.png", plot = microbe.GxE, base_height = 6, base_width = 8)
microbe.GxE <- filter(var.df, Response %in% c("Fungi Rarefied Richness","Bacteria Rarefied Richness")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_microbe_GxE.png", plot = microbe.GxE, base_height = 6, base_width = 8)
arth.GxE <- filter(var.df, Response == "Arthropod Richness") %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Experiment_Year, ncol=1, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_arthropod_GxE.png", plot = arth.GxE, base_height = 6, base_width = 8)
ant_aphid.GxE <- filter(var.df, Response %in% c("Aphis farinosa","Formica obscuripes")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.05, 0.1, 0.15, 0.2), labels=c(0, 5, 10, 15, 20)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_ant-aphid_GxE.png", plot = ant_aphid.GxE, base_height = 6, base_width = 8)
traits.2013 <- filter(var.df, Year == "2013", Response %in% c("Leaf Water Content","SLA","Leaf C:N","Root C:N","Plant Height","Shoot Count","Shoot Length"))
traits.2013$Response_ord <- factor(traits.2013$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "SLA", "Leaf C:N", "Root C:N"))
plot.traits.2013 <- ggplot(traits.2013, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.2, 0.4, 0.6), labels=c(0, 20, 40, 60)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_traits_2013_GxE.png", plot = plot.traits.2013, base_height = 6, base_width = 8)
wind.var.df <- read.csv('output_brms/wind_SDs.csv') %>%
transmute("Genotype (G)" = sd_Genotype__Intercept^2 /        (sd_Genotype__Intercept^2 + sd_sc.Wind.Exposure^2 + sd_Genotype__sc.Wind.Exposure^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Wind =       sd_sc.Wind.Exposure^2 /           (sd_Genotype__Intercept^2 + sd_sc.Wind.Exposure^2 + sd_Genotype__sc.Wind.Exposure^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
"G x Wind" =     sd_Genotype__sc.Wind.Exposure^2 / (sd_Genotype__Intercept^2 + sd_sc.Wind.Exposure^2 + sd_Genotype__sc.Wind.Exposure^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Block =    sd_Block__Intercept^2 /           (sd_Genotype__Intercept^2 + sd_sc.Wind.Exposure^2 + sd_Genotype__sc.Wind.Exposure^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Plot =     sd_Plot_code__Intercept^2 /       (sd_Genotype__Intercept^2 + sd_sc.Wind.Exposure^2 + sd_Genotype__sc.Wind.Exposure^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
sample = sample, Experiment = Experiment, Year = Year, Response = Response) %>%
gather(key = term, value = percent.variance, -(sample:Response)) #%>%
#mutate(Model = "experimental_design")
aa.var.df <- read.csv('output_brms/ant.aphid_SDs.csv') %>%
transmute("Genotype (G)" =    sd_Genotype__Intercept^2 /                            (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Aphid =             sd_sc.Aphid.treatment^2 /                             (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Ant =               sd_sc.Ant.mound.dist^2 /                              (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
"Aphid x Ant" =     sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 /           (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
"G x Aphid" =       sd_Genotype__sc.Aphid.treatment^2 /                   (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
"G x Ant" =         sd_Genotype__sc.Ant.mound.dist^2 /                    (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
"G x Aphid x Ant" = sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 / (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Block =             sd_Block__Intercept^2 /                               (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Plot =              sd_Plot_code__Intercept^2 /                           (sd_Genotype__Intercept^2 + sd_sc.Aphid.treatment^2 + sd_sc.Ant.mound.dist^2 + sd_sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Genotype__sc.Aphid.treatment.sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
sample = sample, Experiment = Experiment, Year = Year, Response = Response) %>%
gather(key = term, value = percent.variance, -(sample:Response)) #%>%
#mutate(Model = "experimental_design")
aphis.var.df <- read.csv('output_brms/ant.aphid_SDs.csv') %>%
filter(Response == "Aphis farinosa") %>%
transmute("Genotype (G)" =    sd_Genotype__Intercept^2 /                            (sd_Genotype__Intercept^2 + sd_sc.Ant.mound.dist^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Ant =               sd_sc.Ant.mound.dist^2 /                              (sd_Genotype__Intercept^2 + sd_sc.Ant.mound.dist^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
"G x Ant" =         sd_Genotype__sc.Ant.mound.dist^2 /                    (sd_Genotype__Intercept^2 + sd_sc.Ant.mound.dist^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Block =             sd_Block__Intercept^2 /                               (sd_Genotype__Intercept^2 + sd_sc.Ant.mound.dist^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
Plot =              sd_Plot_code__Intercept^2 /                           (sd_Genotype__Intercept^2 + sd_sc.Ant.mound.dist^2 + sd_Genotype__sc.Ant.mound.dist^2 + sd_Block__Intercept^2 + sd_Plot_code__Intercept^2 + sigma),
sample = sample, Experiment = Experiment, Year = Year, Response = Response) %>%
gather(key = term, value = percent.variance, -(sample:Response))
var.df <- bind_rows(wind.var.df, aa.var.df, aphis.var.df) %>% #, aa.arth.trait.var, w.arth.trait.var.2012, w.arth.trait.var.2013, w.microbe.trait.soil.var) %>%
unite(Experiment_Year, Experiment, Year, sep = " ", remove = F)
var.df$term <- factor(var.df$term)
levels(var.df$term)
var.df$term_ord <- factor(var.df$term, levels=c("Plot","Block","G x Aphid x Ant","G x Ant","G x Aphid","G x Wind","Aphid x Ant","Ant","Aphid","Wind","Genotype (G)")) # "Soil PC2","Soil PC1", "Root C:N","Trait PC2","Trait PC1"
levels(var.df$term_ord)
## 2012 TRAITS ----
traits.aa.2012 <- filter(var.df, Experiment_Year == "Ant-Aphid 2012", Response %in% c("Leaf Water Content","Trichome Density","Plant Height","Shoot Count","Shoot Length"))
traits.aa.2012$Response_ord <- factor(traits.aa.2012$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "Trichome Density"))
plot.traits.aa.2012 <- ggplot(traits.aa.2012, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.2, 0.4, 0.6), labels=c(0, 20, 40, 60)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_traits_2012_aa_GxE.png", plot = plot.traits.aa.2012, base_height = 6, base_width = 8)
traits.w.2012 <- filter(var.df, Experiment_Year == "Wind 2012", Response %in% c("Leaf Water Content","Trichome Density","Plant Height","Shoot Count","Shoot Length"))
traits.w.2012$Response_ord <- factor(traits.w.2012$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "Trichome Density"))
plot.traits.w.2012 <- ggplot(traits.w.2012, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.2, 0.4, 0.6), labels=c(0, 20, 40, 60)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_traits_2012_wind_GxE.png", plot = plot.traits.w.2012, base_height = 6, base_width = 8)
## 2013 TRAITS ----
traits.2013 <- filter(var.df, Year == "2013", Response %in% c("Leaf Water Content","SLA","Leaf C:N","Root C:N","Plant Height","Shoot Count","Shoot Length"))
traits.2013$Response_ord <- factor(traits.2013$Response, levels=c("Plant Height", "Shoot Count", "Shoot Length", "Leaf Water Content", "SLA", "Leaf C:N", "Root C:N"))
plot.traits.2013 <- ggplot(traits.2013, aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.2, 0.4, 0.6), labels=c(0, 20, 40, 60)) +
facet_wrap(~Response_ord, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_traits_2013_GxE.png", plot = plot.traits.2013, base_height = 6, base_width = 8)
## ANT-APHID INTERACTIONS ----
ant_aphid.GxE <- filter(var.df, Response %in% c("Aphis farinosa","Formica obscuripes")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.05, 0.1, 0.15, 0.2), labels=c(0, 5, 10, 15, 20)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_ant-aphid_GxE.png", plot = ant_aphid.GxE, base_height = 6, base_width = 8)
## ARTHROPOD GXE ----
arth.GxE <- filter(var.df, Response == "Arthropod Richness") %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Experiment_Year, ncol=1, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_arthropod_GxE.png", plot = arth.GxE, base_height = 6, base_width = 8)
## MICROBIAL GXE ----
microbe.GxE <- filter(var.df, Response %in% c("Fungi Rarefied Richness","Bacteria Rarefied Richness")) %>%
ggplot(., aes(x=term_ord, y=percent.variance)) +
stat_summary(fun.ymax=function(y) quantile(y,0.975), fun.ymin=function(y) quantile(y,0.025), geom="linerange", color="grey") +
stat_summary(fun.y = median, fun.ymax=function(y) quantile(y,0.75), fun.ymin=function(y) quantile(y,0.25),
geom="pointrange", size=1) +
coord_flip() +
ylab("Variance Explained (%)") +
xlab("") +
scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3), labels=c(0, 10, 20, 30)) +
facet_wrap(~Response, ncol=1, scales = "free_y") +
theme_cowplot()
save_plot(filename = "fig_microbe_GxE.png", plot = microbe.GxE, base_height = 6, base_width = 8)
## LOAD LIBRARIES ----
library(tidyverse)
library(brms)
library(rstan)
library(broom)
library(parallel)
## SET OPTIONS ----
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
## WIND TRAIT DATA ----
w.trait.df <- read.csv('final_data/wind_trait_df.csv') %>% tbl_df() %>% mutate(Block = as.factor(Block), Plot_code = paste(Block, Wind.Exposure, sep="_"))
w.trait.2012 <- filter(w.trait.df, Year=="2012") %>%
mutate(sc.Wind.Exposure = scale(as.numeric(Wind.Exposure)),
sc.Trait.PC1 = scale(trait.PC1),
trans.trait.PC2 = trait.PC2-min(trait.PC2)+1,          # make positive to enable log-transformation
sc.log.trans.Trait.PC2 = scale(log(trans.trait.PC2)))  # log-transform to normalize prior to scaling
w.trait.2013 <- filter(w.trait.df, Year=="2013") %>%
mutate(sc.Wind.Exposure = scale(as.numeric(Wind.Exposure)),
sc.Trait.PC1 = scale(trait.PC1),
sc.Trait.PC2 = scale(trait.PC2),
sc.log.Root.CN = scale(log(root_CN)))                  # log-transform to normalize prior to scaling
## ANT-APHID TRAIT DATA ----
aa.trait.df <- read.csv('final_data/ant_aphid_trait_df.csv') %>% tbl_df() %>% mutate(Block=as.factor(Block), Plot_code=paste(Block, Ant.mound.dist, sep="_"))
aa.trait.2012 <- filter(aa.trait.df, Year=="2012") %>%
mutate(sc.Aphid.treatment = scale(as.numeric(Aphid.treatment)),
sc.Ant.mound.dist=scale(Ant.mound.dist),
sc.Trait.PC1 = scale(trait.PC1),
sc.Trait.PC2 = scale(trait.PC2))
## ANT-APHID ARTHROPOD COMMUNITY DATA ----
aa.arth.df <- read.csv('final_data/ant_aphid_arthropod_df.csv') %>% tbl_df() %>%
mutate(Block = as.factor(Block),
sc.Aphid.treatment=scale(as.numeric(Aphid.treatment)),
sc.Ant.mound.dist=scale(Ant.mound.dist),
sc.log1.Arthropod.Rich = scale(log(total.rich+1)))          # log(x+1) to normalize prior to scaling
## WIND ARTHROPOD COMMUNITY DATA ----
# (dead plants have already been removed)
wind.arth.df <- read.csv('final_data/wind_arthropod_df.csv') %>% tbl_df() %>% mutate(Block = as.factor(Block), Plot_code = interaction(Block, Wind.Exposure))
w.arth.2012 <- wind.arth.df %>% filter(Year == "2012") %>%
mutate(sc.Wind.Exposure = scale(as.numeric(Wind.Exposure)),
sc.log1.Arthropod.Rich = scale(log(total.rich+1)))         # log(x+1) to normalize prior to scaling
w.arth.2013 <- wind.arth.df %>% filter(Year == "2013") %>%
mutate(sc.Wind.Exposure = scale(as.numeric(Wind.Exposure)),
sc.log1.Arthropod.Rich = scale(log(total.rich+1)))         # log(x+1) to normalize prior to scaling
## WIND FUNGAL COMMUNITY DATA ----
fungal.df <- read.csv("final_data/fungal.df.csv") %>% tbl_df() %>%
mutate(Block = as.factor(Block),
sc.Wind.Exposure = scale(as.numeric(Wind.Exposure)),
sc.Fungi.Rarerich = scale(fungal.rarerich))
## WIND BACTERIA COMMUNITY DATA ----
bacteria.df <- read.csv("final_data/bacteria.df.csv") %>% tbl_df() %>%
mutate(Block = as.factor(Block),
sc.Wind.Exposure = scale(as.numeric(Wind.Exposure)),
sc.Bacteria.Rarerich = scale(bacteria.rarerich))
## WIND SOIL DATA ----
w.soil <- read.csv('final_data/wind_soil_df.csv') %>% tbl_df() %>%
mutate(Block = as.factor(Block),
sc.Wind.Exposure = scale(as.numeric(Wind.Exposure)),
soil.PC1.trans = soil.PC1-min(soil.PC1)+1,             # make positive to enable log-transformation
sc.log.trans.Soil.PC1 = scale(log(soil.PC1.trans)),
sc.Soil.PC2 = scale(soil.PC2))
## FUNCTIONS FOR ANALYSIS ----
general_brm <- function(formula, family, data, ...) {
brm(formula=formula, data=data, family=gaussian(link="identity"),
prior=c(prior(normal(0,1), class=b),
prior(normal(0,1), class=sd)),
control=list(adapt_delta=0.99),
chains=4)
# all other brm parameters correspond to the defaults
}
posterior_SDs <- function(brm_model, df, FE_formula){
Fixed_Effects <- posterior_samples(brm_model, pars = "^b")
sample_size <- dim(Fixed_Effects)[1]
get_model_matrix <- model.matrix(as.formula(FE_formula), data=df)
model_size <- dim(get_model_matrix)[2]
FE_SD_list <- list()
for(i in 1:model_size){
FE_SD_vector <- c()
for(j in 1:sample_size){
FE_SD_vector[j] <- sd(as.vector(Fixed_Effects[j,i] * t(get_model_matrix)[i, ]))
}
FE_SD_list[[i]] <- FE_SD_vector
}
FE_SD_df <- as.data.frame(FE_SD_list)
colnames(FE_SD_df) <- gsub("b_", "sd_", colnames(Fixed_Effects))
SD_df <- data.frame(sample = 1:4000,
FE_SD_df,                                         # fixed effects
posterior_samples(brm_model, pars = "^sd"),       # random effects
posterior_samples(brm_model, pars = "sigma"))     # residual variance
return(SD_df)
}
belowground <- left_join(transmute(w.trait.2013, plant_ID, sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N))
w.trait.2013
belowground <- left_join(transmute(w.trait.2013, BlocK:plant_ID, Plot_code, sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N))
belowground <- left_join(transmute(w.trait.2013, Block:plant_ID, Plot_code, sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N))
root_CN.wind.2013 <- general_brm(sc.log.Root.CN~sc.Wind.Exposure+sc.log.trans.Soil.PC1+sc.Soil.PC2+(1+sc.Wind.Exposure|Genotype)+(1|Block)+(1|Plot_code), data=w.trait.2013)
w.soil
belowground <- left_join(transmute(w.trait.2013, Block:plant_ID, Plot_code, sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N))
belowground
belowground <- left_join(transmute(w.trait.2013, Block, Wind.Exposure, Genotype, plant_ID, Plot_code, sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N))
belowground
root_CN.wind.2013 <- general_brm(sc.log.Root.CN~sc.Wind.Exposure+sc.log.trans.Soil.PC1+sc.Soil.PC2+(1+sc.Wind.Exposure|Genotype)+(1|Block)+(1|Plot_code), data=belowground)
belowground <- left_join(transmute(w.trait.2013, Block, sc.Wind.Exposure=scale(as.numeric(Wind.Exposure)), Genotype, plant_ID, Plot_code, sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N))
root_CN.wind.2013 <- general_brm(sc.log.Root.CN~sc.Wind.Exposure+sc.log.trans.Soil.PC1+sc.Soil.PC2+(1+sc.Wind.Exposure|Genotype)+(1|Block)+(1|Plot_code), data=belowground)
root_CN.wind.2013 <- general_brm(sc.log.Root.CN~sc.Wind.Exposure+sc.log.trans.Soil.PC1+sc.Soil.PC2+(1+sc.Wind.Exposure|Genotype)+(1|Block)+(1|Plot_code), data=belowground)
str(belowground)
w.soil
w.trait.2013
w.trait.2013$Plot_code
fungal.df
w.trait.2013
belowground <- left_join(transmute(w.trait.2013, Block, sc.Wind.Exposure=scale(as.numeric(Wind.Exposure)), Genotype, plant_ID, Plot_code=paste(Block,ifelse(Wind.Exposure=="Exposed","E","U"),sep="."), sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N))
belowground
str(belowground)
belowground <- left_join(transmute(w.trait.2013, Block, sc.Wind.Exposure=scale(as.numeric(Wind.Exposure)), Genotype, plant_ID, Plot_code=paste(Block,ifelse(Wind.Exposure=="Exposed","E","U"),sep="."), sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N))
root_CN.wind.2013 <- general_brm(sc.log.Root.CN~sc.Wind.Exposure+sc.log.trans.Soil.PC1+sc.Soil.PC2+(1+sc.Wind.Exposure|Genotype)+(1|Block)+(1|Plot_code), data=belowground)
summary(root_CN.wind.2013)
belowground <- left_join(transmute(w.trait.2013, Block, sc.Wind.Exposure=scale(as.numeric(Wind.Exposure)), Genotype, plant_ID, Plot_code=paste(Block,ifelse(Wind.Exposure=="Exposed","E","U"),sep="."), sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N)) %>%
left_join(., transmute(Plot_code, fungal_rarerich))
belowground <- left_join(transmute(w.trait.2013, Block, sc.Wind.Exposure=scale(as.numeric(Wind.Exposure)), Genotype, plant_ID, Plot_code=paste(Block,ifelse(Wind.Exposure=="Exposed","E","U"),sep="."), sc.log.Root.CN = as.numeric(sc.log.Root.CN), root_C.perc, root_N.perc),
transmute(w.soil, Plot_code, sc.log.trans.Soil.PC1=as.numeric(sc.log.trans.Soil.PC1), sc.Soil.PC2=as.numeric(sc.Soil.PC2), Total.N, NO3.N, NH4.N)) %>%
left_join(., transmute(fungal.df, Plot_code, fungal_rarerich))
install.packages("installr")
install.packages("checkpoint")
library(checkpoint)
checkpoint("2017-04-21")
